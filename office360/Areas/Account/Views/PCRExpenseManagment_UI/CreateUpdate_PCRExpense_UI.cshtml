@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    @@keyframes blinker {
        50% {
            opacity: 0;
        }
    }

    .blink-effect {
        animation: blinker 3s linear infinite;
    }

    .sticky-top {
        position: sticky;
        top: 0;
        z-index: 10;
        background: #f8f9fa;
    }

    .btn-xs {
        padding: 1px 5px;
        font-size: 0.7rem;
        line-height: 1.5;
    }

    .table-responsive::-webkit-scrollbar {
        width: 6px;
    }

    .table-responsive::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 10px;
    }
    /* Visual feedback for disabled buttons */
    .btn-primary:disabled {
        cursor: not-allowed;
        opacity: 0.7;
    }
</style>

<script src="~/Scripts/angular.min.js"></script>
<script src="~/Common/CommonScripts/AngularService/GlobalServices.js"></script>
<script src="~/Areas/Account/Scripts/PCRExpenseManagment_UI_Script/CreateUpdate_PCRExpense_UI_Presenter.js"></script>
<div class="statbox widget box box-shadow">
    <div class="widget-header">
        <div class="row">
            <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                <h4>@ViewBag.Title</h4>
            </div>
        </div>
        <nav class="breadcrumb-one" aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="javascript:void(0);"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg></a></li>
                <li class="breadcrumb-item"><a href="javascript:void(0);">Accounts</a></li>
                <li class="breadcrumb-item"><a href="javascript:void(0);">Petty Cash Register</a></li>
                <li class="breadcrumb-item active" aria-current="page"><span>Add Expense</span></li>
            </ol>
        </nav>
    </div>
</div>
<div ng-app="CreateUpdate_PCRExpense_UI" ng-controller="CreateUpdate_PCRExpense_UIController" style="margin-top:5px">
    <form name="PCRExpenseForm" novalidate>
        <div class="row g-3">
            <div class="col-md-4">
                <div class="card rounded shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center fw-bold">
                        <span>Add Expense Entry</span>
                        <button type="button" class="btn btn-sm btn-outline-secondary" ng-click="ResetForm()">Reset</button>
                    </div>

                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Date</label>
                                <input type="text" name="TransactionDate" id="TextBoxTransactionDate" class="form-control" ng-model="PCRExpense.TransactionDate" date-picker-simple required>
                                <div class="text-danger mt-1" ng-show="PCRExpenseForm.TransactionDate.$touched && PCRExpenseForm.TransactionDate.$invalid">Date is required.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Invoice Number</label>
                                <input type="text" name="InvoiceNumber" class="form-control" placeholder="Enter Invoice" ng-model="PCRExpense.InvoiceNumber">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea name="Description" class="form-control" placeholder="Enter Description" ng-model="PCRExpense.Description" required rows="2"></textarea>
                            <div class="text-danger mt-1" ng-show="PCRExpenseForm.Description.$touched && PCRExpenseForm.Description.$invalid">Description is required.</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Expense Category</label>
                            <select class="form-select" name="ExpenseCategoryId"
                                    ng-model="PCRExpense.ExpenseCategoryId"
                                    ng-options="p.Id as p.Description for p in ExpenseCategoryList track by p.Id" select2 required>
                            </select>
                            <div class="text-danger mt-1" ng-show="PCRExpenseForm.ExpenseCategoryId.$touched && PCRExpenseForm.ExpenseCategoryId.$invalid">Please select a category.</div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Qty</label>
                                <input type="number" name="Quantity" class="form-control" ng-model="PCRExpense.Quantity" ng-change="PCRExpense.NetAmount = (PCRExpense.Quantity || 0) * (PCRExpense.UnitPrice || 0)" min="1" required>
                            </div>

                            <div class="col-md-4 mb-3">
                                <label class="form-label">Unit Price</label>
                                <input type="number" name="UnitPrice" class="form-control" ng-model="PCRExpense.UnitPrice" ng-change="PCRExpense.NetAmount = (PCRExpense.Quantity || 0) * (PCRExpense.UnitPrice || 0)" min="0.01" required>
                            </div>

                            <div class="col-md-4 mb-3">
                                <label class="form-label">Net Total</label>
                                <input type="text" class="form-control bg-light fw-bold text-danger" value="{{PCRExpense.NetAmount | number:2}}" readonly>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Remarks</label>
                            <textarea name="Remarks" class="form-control" placeholder="Optional notes" ng-model="PCRExpense.Remarks" rows="2"></textarea>
                        </div>
                    </div>

                    <div class="card-footer text-end">
                        <button type="button" class="btn btn-primary px-4 shadow-sm"
                                ng-click="UpsertDataIntoDB()"
                                ng-disabled="isProcessing || PCRExpenseForm.$invalid">
                            <span ng-show="isProcessing"><i class="fa fa-spinner fa-spin me-1"></i> Saving...</span>
                            <span ng-hide="isProcessing">{{ IsEditMode ? 'Update Expense' : 'Add Expense' }}</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-md-8">
                <div class="card bg-light mb-3 border-0 shadow-sm">
                    <div class="card-body p-2">
                        <div class="row g-2">
                            <div class="col-md-4">
                                <div class="border-start border-success border-3 shadow-xs rounded bg-white p-2">
                                    <small class="text-muted d-block" style="font-size: 0.65rem;">Total Received</small>
                                    <span class="fw-bold text-success" style="font-size: 1rem;">{{ PCRKPISummary.SummaryPCRIncome | number:2 }}</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="border-start border-primary border-3 shadow-xs rounded bg-white p-2">
                                    <small class="text-muted d-block" style="font-size: 0.65rem;">Total Expenditure</small>
                                    <span class="fw-bold text-primary" style="font-size: 1rem;">{{ PCRKPISummary.SummaryPCRExpense | number:2 }}</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="border-start border-dark border-3 shadow-xs rounded bg-white p-2">
                                    <small class="text-muted d-block" style="font-size: 0.65rem;">Available Balance</small>
                                    <span class="fw-bold text-dark" style="font-size: 1rem;">{{ (PCRKPISummary.SummaryPCRIncome - PCRKPISummary.SummaryPCRExpense) | number:2 }}</span>
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="row g-2">
                            <div class="col-md-4">
                                <div class="border-start border-success border-3 shadow-xs rounded bg-white p-2">
                                    <small class="text-muted d-block" style="font-size: 0.65rem;">Received In @DateTime.Now.ToString("MMMM")</small>
                                    <span class="fw-bold text-info" style="font-size: 1rem;">{{ PCRKPISummary.MonthlyPCRIncome | number:2 }}</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="border-start border-primary border-3 shadow-xs rounded bg-white p-2">
                                    <small class="text-muted d-block" style="font-size: 0.65rem;">Expenditure In  @DateTime.Now.ToString("MMMM")</small>
                                    <span class="fw-bold text-danger" style="font-size: 1rem;">{{ PCRKPISummary.MonthlyPCRExpense | number:2 }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card rounded border-0 shadow-sm">
                    <div class="card-header bg-white py-2">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <span class="fw-bold small">Transaction History</span>
                                <div ng-show="DataTableSetting.Filter.ExpenseCategory" class="text-danger" style="font-size: 0.75rem;">
                                    Sub Total: <strong>{{ ExpenseCategorySum(DataTableSetting.FilteredExpenseList) | number:2 }}</strong>
                                </div>

                            </div>
                            <div class="col-md-8 text-end">
                                <div class="d-flex justify-content-end gap-1">
                                    <select class="form-select form-select-sm" style="width: 180px;" ng-model="DataTableSetting.Filter.ExpenseCategory" size="2" ng-options="p.Id as p.Description for p in ExpenseCategoryList track by p.Id">
                                        <option value="">-- All Categories --</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table-sm table-hover mb-0 table" style="font-size: 0.85rem;">
                                <thead class="table-light sticky-top">
                                    <tr>
                                        <th class="ps-3">Date</th>
                                        <th>Description</th>
                                        <th>Category</th>
                                        <th class="pe-3 text-end">Amount</th>
                                        <th class="text-center">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="item in DataTableSetting.FilteredExpenseList | startFrom:DataTableSetting.DefaultPage * DataTableSetting.RecordLength | limitTo:DataTableSetting.RecordLength">
                                        <td class="ps-3">{{ item.TransactionDate | date:'dd-MMM-yyyy' }}</td>
                                        <td class="text-truncate" style="max-width: 200px;" title="{{item.Description}}">{{ item.Description }}</td>
                                        <td>{{ Get_ExpenseCategory_ById(item.ExpenseCategoryId) }}</td>
                                        <td class="fw-bold pe-3 text-end">{{ item.NetAmount | number:2 }}</td>
                                        <td class="text-center">
                                            <a href="javascript:void(0)" class="text-primary me-2" ng-click="Load_PCRExpense_InfoById(item, true)"><i class="fa fa-edit"></i></a>
                                            <a href="javascript:void(0)" class="text-danger" ng-click="Delete_PCRExpense_ById(item.GuID)"><i class="fa fa-trash"></i></a>
                                        </td>
                                    </tr>
                                    <tr ng-if="DataTableSetting.FilteredExpenseList.length === 0">
                                        <td colspan="5" class="text-muted py-4 text-center">No records found.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer d-flex justify-content-between align-items-center bg-white">
                        <small class="text-muted">Page {{DataTableSetting.DefaultPage + 1}} of {{numberOfPages()}}</small>
                        <div class="btn-group">
                            <button class="btn btn-xs btn-outline-secondary" ng-disabled="DataTableSetting.DefaultPage == 0" ng-click="DataTableSetting.DefaultPage = DataTableSetting.DefaultPage - 1">Prev</button>

                            <button class="btn btn-xs btn-outline-secondary"
                                    ng-disabled="DataTableSetting.DefaultPage >= (DataTableSetting.FilteredExpenseList.length / DataTableSetting.RecordLength) - 1"
                                    ng-click="DataTableSetting.DefaultPage = DataTableSetting.DefaultPage + 1">
                                Next
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>